# โ ะฃะปัััะตะฝะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต Email ะฒ ะฟัะพัะธะปะต

## ๐ง ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ:

### 1. **ะัะพะฑัะฐะถะตะฝะธะต ัะตะฐะปัะฝะพะณะพ Email**
- โ ะะพะบะฐะทัะฒะฐะตััั **ัะตะฐะปัะฝัะน email** ะฟะพะปัะทะพะฒะฐัะตะปั (`user.email`)
- โ ะะพะปััะต ะฝะต ะฟะพะบะฐะทัะฒะฐะตััั UUID (`user_id`)
- โ Email ะพัะพะฑัะฐะถะฐะตััั ะฒ ัะพัะผะฐัะต `font-mono` ะดะปั ะปัััะตะน ัะธัะฐะตะผะพััะธ

### 2. **ะกัะฐััั ะฒะตัะธัะธะบะฐัะธะธ**
ะัะฐัะธะฒะฐั ะฟะปะฐัะบะฐ ั ะธะบะพะฝะบะพะน:
- โ **ะะพะดัะฒะตัะถะดัะฝ** (ะทะตะปัะฝัะน badge) โ ะตัะปะธ `user.email_confirmed_at` ัััะตััะฒัะตั
- โ **ะะต ะฟะพะดัะฒะตัะถะดัะฝ** (ะถัะปััะน badge) โ ะตัะปะธ email ะฝะต ะฟะพะดัะฒะตัะถะดัะฝ

### 3. **ะะพะฒัะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฟะธััะผะฐ**
- โ Alert ั ะบะฝะพะฟะบะพะน "ะัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ"
- โ ะะพะบะฐะทัะฒะฐะตััั ัะพะปัะบะพ ะตัะปะธ email ะฝะต ะฟะพะดัะฒะตัะถะดัะฝ
- โ ะะฝะพะฟะบะฐ ั ะธะบะพะฝะบะพะน `RefreshCw` ะธ ะฐะฝะธะผะฐัะธะตะน ะฟัะธ ะทะฐะณััะทะบะต
- โ ะัะฟะพะปัะทัะตั Supabase `auth.resend()` API

### 4. **ะะทะผะตะฝะตะฝะธะต Email ัะตัะตะท ะผะพะดะฐะปะบั**

#### ะจะฐะณ 1: ะะพะดัะฒะตัะถะดะตะฝะธะต ะฟะฐัะพะปะตะผ
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ัะตะบััะธะน ะฟะฐัะพะปั
- ะัะพะฒะตัะบะฐ ัะตัะตะท `supabase.auth.signInWithPassword()`
- ะัะปะธ ะฝะตะฒะตัะฝัะน ะฟะฐัะพะปั โ ะฟะพะบะฐะทัะฒะฐะตััั ะพัะธะฑะบะฐ

#### ะจะฐะณ 2: ะะฒะพะด ะฝะพะฒะพะณะพ Email
- ะะพะบะฐะทัะฒะฐะตััั ัะตะบััะธะน email (disabled)
- ะะพะปะต ะดะปั ะฒะฒะพะดะฐ ะฝะพะฒะพะณะพ email
- ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะฐ email
- ะัะพะฒะตัะบะฐ ััะพ ะฝะพะฒัะน email ะพัะปะธัะฐะตััั ะพั ัะตะบััะตะณะพ

#### ะจะฐะณ 3: ะัะฟัะฐะฒะบะฐ ะฟะพะดัะฒะตัะถะดะตะฝะธั
- ะัะฟะพะปัะทัะตััั `supabase.auth.updateUser({ email: newEmail })`
- Supabase ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฟัะฐะฒะปัะตั ะฟะธััะผะพ ะฝะฐ ะฝะพะฒัะน email
- ะะพะบะฐะทัะฒะฐะตััั ะธะฝัะพัะผะฐัะธั ะพ ะฝะตะพะฑัะพะดะธะผะพััะธ ะฟะพะดัะฒะตัะถะดะตะฝะธั

---

## ๐ ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั:

### **`src/components/EmailSection.tsx`**
ะะพะผะฟะพะฝะตะฝั ะดะปั ะพัะพะฑัะฐะถะตะฝะธั email ั ะฒะตัะธัะธะบะฐัะธะตะน:
```typescript
<EmailSection
    email={user?.email || ''}
    isVerified={!!user?.email_confirmed_at}
    onEmailChanged={() => {/* refresh user */}}
/>
```

**ะคัะฝะบัะธะธ:**
- ะัะพะฑัะฐะถะตะฝะธะต email ะธ ััะฐัััะฐ ะฒะตัะธัะธะบะฐัะธะธ
- ะะฝะพะฟะบะฐ "ะะทะผะตะฝะธัั" ะดะปั ะพัะบัััะธั ะผะพะดะฐะปะบะธ
- Alert ั ะบะฝะพะฟะบะพะน "ะัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ" (ะตัะปะธ ะฝะต ะฟะพะดัะฒะตัะถะดัะฝ)
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ั toast ัะฒะตะดะพะผะปะตะฝะธัะผะธ

---

### **`src/components/auth/EmailChangeModal.tsx`**
ะะพะดะฐะปัะฝะพะต ะพะบะฝะพ ะดะปั ะธะทะผะตะฝะตะฝะธั email:

**ะญัะฐะฟั:**
1. **password** โ ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะฟะฐัะพะปะตะผ
2. **new-email** โ ะฒะฒะพะด ะฝะพะฒะพะณะพ email
3. **verification** โ ะพะถะธะดะฐะฝะธะต ะฟะพะดัะฒะตัะถะดะตะฝะธั

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะฐ email
- ะัะพะฒะตัะบะฐ ัะฝะธะบะฐะปัะฝะพััะธ ะฝะพะฒะพะณะพ email
- ะัะฐัะธะฒัะต ะธะบะพะฝะบะธ (Lock, Mail, Key)
- ะะฝัะพัะผะฐัะธะฒะฝัะต ะพะฟะธัะฐะฝะธั ะฝะฐ ะบะฐะถะดะพะผ ัะฐะณะต
- ะะฑัะฐะฑะพัะบะฐ ะฒัะตั ะพัะธะฑะพะบ

---

## ๐ ะะตัะตะฒะพะดั:

ะะพะฑะฐะฒะปะตะฝั ะฟะตัะตะฒะพะดั ะดะปั **4 ัะทัะบะพะฒ** (en, uk, ru, pl):

### profile.email.*
```typescript
{
    verified: 'ะะพะดัะฒะตัะถะดัะฝ',
    notVerified: 'ะะต ะฟะพะดัะฒะตัะถะดัะฝ',
    pleaseVerify: 'ะะพะถะฐะปัะนััะฐ, ะฟะพะดัะฒะตัะดะธัะต ะฒะฐั email ะฐะดัะตั',
    resend: 'ะัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ',
    change: 'ะะทะผะตะฝะธัั',
    changeTitle: 'ะะทะผะตะฝะธัั Email',
    passwordDesc: 'ะะพะดัะฒะตัะดะธัะต ะฒะฐั ัะตะบััะธะน ะฟะฐัะพะปั ะดะปั ะธะทะผะตะฝะตะฝะธั email',
    newEmailDesc: 'ะะฒะตะดะธัะต ะฒะฐั ะฝะพะฒัะน email ะฐะดัะตั',
    verificationDesc: 'ะะธััะผะพ ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ ะพัะฟัะฐะฒะปะตะฝะพ ะฝะฐ ะฝะพะฒัะน ะฐะดัะตั',
    currentPassword: 'ะขะตะบััะธะน ะฟะฐัะพะปั',
    enterPassword: 'ะะฒะตะดะธัะต ะฟะฐัะพะปั',
    current: 'ะขะตะบััะธะน Email',
    new: 'ะะพะฒัะน Email',
    enterNewEmail: 'ะะฒะตะดะธัะต ะฝะพะฒัะน email',
    sendVerification: 'ะัะฟัะฐะฒะธัั ะฟะพะดัะฒะตัะถะดะตะฝะธะต',
    verificationSent: 'ะะธััะผะพ ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ ะพัะฟัะฐะฒะปะตะฝะพ ะฝะฐ',
    checkInbox: 'ะัะพะฒะตัััะต ะฒัะพะดััะธะต ะฟะธััะผะฐ ะธ ะฟะตัะตะนะดะธัะต ะฟะพ ัััะปะบะต ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั.',
    afterVerification: 'ะะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฒะฐั email ะฑัะดะตั ะธะทะผะตะฝัะฝ.',
    verificationSentTitle: 'ะะธััะผะพ ะพัะฟัะฐะฒะปะตะฝะพ',
    verificationSentDesc: 'ะัะพะฒะตัััะต ะฒัะพะดััะธะต ะฟะธััะผะฐ ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั email',
    changeSuccessTitle: 'Email ะธะทะผะตะฝัะฝ',
    changeSuccessDesc: 'ะัะพะฒะตัััะต ะฝะพะฒัะน email ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั',
    wrongPassword: 'ะะตะฒะตัะฝัะน ะฟะฐัะพะปั',
    invalidEmail: 'ะะตะฒะตัะฝัะน ัะพัะผะฐั email',
    sameEmail: 'ะะพะฒัะน email ัะพะฒะฟะฐะดะฐะตั ั ัะตะบััะธะผ',
}
```

### common.* (ะดะพะฟะพะปะฝะธัะตะปัะฝัะต)
```typescript
{
    continue: 'ะัะพะดะพะปะถะธัั',
    close: 'ะะฐะบัััั',
    errorOccurred: 'ะัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ'
}
```

---

## ๐ง ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั:

### **`src/pages/ProfilePage.tsx`**
```diff
- const { profile, updateProfile } = useAuth();
+ const { user, profile, updateProfile } = useAuth();

+ import EmailSection from '@/components/EmailSection';

- <Label htmlFor="email">{t('profile.email', 'Email')}</Label>
- <Input
-     id="email"
-     type="email"
-     value={profile.user_id}  โ UUID!
-     disabled
-     className="bg-muted cursor-target"
- />

+ <EmailSection
+     email={user?.email || ''}
+     isVerified={!!user?.email_confirmed_at}
+     onEmailChanged={async () => {
+         const { data: { user: refreshedUser } } = await supabase.auth.getUser();
+     }}
+ />
```

---

## โจ ะัะตะธะผััะตััะฒะฐ:

### UX
- โ ะะพะฝััะฝัะน ััะฐััั ะฒะตัะธัะธะบะฐัะธะธ email
- โ ะัะพััะฐั ะฟะพะฒัะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฟะธััะผะฐ
- โ ะะตะทะพะฟะฐัะฝะพะต ะธะทะผะตะฝะตะฝะธะต email ั ะฟะพะดัะฒะตัะถะดะตะฝะธะตะผ ะฟะฐัะพะปะตะผ
- โ ะะพัะฐะณะพะฒะฐั ะผะพะดะฐะปะบะฐ ะฑะตะท ะฟััะฐะฝะธัั

### Security
- โ ะะพะดัะฒะตัะถะดะตะฝะธะต ะฟะฐัะพะปะตะผ ะฟะตัะตะด ะธะทะผะตะฝะตะฝะธะตะผ email
- โ ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะฐ email
- โ ะัะพะฒะตัะบะฐ ัะฝะธะบะฐะปัะฝะพััะธ ะฝะพะฒะพะณะพ email
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะฟัะฐะฒะบะฐ ะฟะธััะผะฐ ะฟะพะดัะฒะตัะถะดะตะฝะธั ัะตัะตะท Supabase

### UI/UX
- โ ะัะฐัะธะฒัะต badge ะดะปั ััะฐัััะฐ
- โ ะะบะพะฝะบะธ ะดะปั ะปัััะตะน ะฒะธะทัะฐะปะธะทะฐัะธะธ
- โ Alert ั ะฟัะธะทัะฒะพะผ ะบ ะดะตะนััะฒะธั
- โ ะะฐะณััะทะพัะฝัะต ัะพััะพัะฝะธั
- โ ะะฝัะพัะผะฐัะธะฒะฝัะต ัะพะพะฑัะตะฝะธั ะพะฑ ะพัะธะฑะบะฐั

### Accessibility
- โ ะกะตะผะฐะฝัะธัะฝัะต HTML ัะปะตะผะตะฝัั
- โ Aria-labels ะฝะฐ ะฒัะตั ะธะฝัะตัะฐะบัะธะฒะฝัั ัะปะตะผะตะฝัะฐั
- โ Keyboard navigation
- โ Focus states

---

## ๐ฏ ะัะฟะพะปัะทะพะฒะฐะฝะธะต:

### ะ ะฟัะพัะธะปะต ะฟะพะปัะทะพะฒะฐัะตะปั:
1. ะัะบัััั **ะัะพัะธะปั** โ ะฒะบะปะฐะดะบะฐ **Personal Info**
2. ะะธะดะธะผ ัะฒะพะน **ัะตะฐะปัะฝัะน email** ะธ **ััะฐััั ะฒะตัะธัะธะบะฐัะธะธ**
3. ะัะปะธ ะฝะต ะฟะพะดัะฒะตัะถะดัะฝ โ ะผะพะถะตะผ **ะพัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ**
4. ะะฝะพะฟะบะฐ **"ะะทะผะตะฝะธัั"** โ ะผะพะดะฐะปะบะฐ:
   - ะะฒะตััะธ ัะตะบััะธะน ะฟะฐัะพะปั
   - ะะฒะตััะธ ะฝะพะฒัะน email
   - ะะพะดัะฒะตัะดะธัั ะฟะพ ัััะปะบะต ะฒ ะฟะธััะผะต

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั:

### Supabase Authentication
- Email ะธะทะผะตะฝัะตััั ัะตัะตะท `supabase.auth.updateUser()`
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะฟัะฐะฒะบะฐ ะฟะธััะผะฐ ะฟะพะดัะฒะตัะถะดะตะฝะธั
- Email ะพะฑะฝะพะฒะปัะตััั ัะพะปัะบะพ ะฟะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั
- ะะฐัะธัะฐ ะพั ัะฟะฐะผะฐ ั ะฟะพะผะพััั rate limiting

### ะะฐะปะธะดะฐัะธั
- ะัะพะฒะตัะบะฐ ัะพัะผะฐัะฐ email (regex)
- ะะพะดัะฒะตัะถะดะตะฝะธะต ัะตะบััะตะณะพ ะฟะฐัะพะปั
- ะัะพะฒะตัะบะฐ ััะพ ะฝะพะฒัะน email ะพัะปะธัะฐะตััั

---

## ๐จ UI Components:

### EmailSection
```typescript
interface EmailSectionProps {
    email: string;              // user.email
    isVerified: boolean;        // !!user.email_confirmed_at
    onEmailChanged?: () => void;
}
```

### EmailChangeModal
```typescript
interface EmailChangeModalProps {
    isOpen: boolean;
    onClose: () => void;
    currentEmail: string;
    onEmailChanged: () => void;
}
```

---

## ๐ธ ะะธะทัะฐะปัะฝัะต ัะปะตะผะตะฝัั:

### Email Display
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ง Email                                โ
โ                                         โ
โ user@example.com  [โ ะะพะดัะฒะตัะถะดัะฝ]      โ
โ                                         โ
โ                        [ะะทะผะตะฝะธัั]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะต ะฟะพะดัะฒะตัะถะดัะฝ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ง Email                                โ
โ                                         โ
โ user@example.com  [โ ะะต ะฟะพะดัะฒะตัะถะดัะฝ]   โ
โ                                         โ
โ                        [ะะทะผะตะฝะธัั]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ ะะพะถะฐะปัะนััะฐ, ะฟะพะดัะฒะตัะดะธัะต ะฒะฐั email    โ
โ            [๐ ะัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ]      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพะดะฐะปะบะฐ ะธะทะผะตะฝะตะฝะธั
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ง ะะทะผะตะฝะธัั Email                   [โ]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะพะดัะฒะตัะดะธัะต ะฒะฐั ัะตะบััะธะน ะฟะฐัะพะปั         โ
โ                                        โ
โ ๐ ะขะตะบััะธะน ะฟะฐัะพะปั                      โ
โ [................................]      โ
โ                                        โ
โ           [ะัะผะตะฝะฐ]  [ะัะพะดะพะปะถะธัั]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพัะพะฒะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

ะัะต ะบะพะผะฟะพะฝะตะฝัั ะฟะพะปะฝะพัััั ััะฝะบัะธะพะฝะฐะปัะฝั ะธ ะณะพัะพะฒั ะบ ะฟัะพะดะฐะบัะตะฝั! โ

### ะัะพะฑะตะฝะฝะพััะธ:
- โ ะะตะฐะปัะฝัะน email ะฒะผะตััะพ UUID
- โ ะกัะฐััั ะฒะตัะธัะธะบะฐัะธะธ ั ะธะบะพะฝะบะฐะผะธ
- โ ะะพะฒัะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฟะธััะผะฐ
- โ ะะตะทะพะฟะฐัะฝะพะต ะธะทะผะตะฝะตะฝะธะต email
- โ 4 ัะทัะบะฐ (en, uk, ru, pl)
- โ Accessibility
- โ ะัะฐัะธะฒัะน UI/UX

